<!DOCTYPE html>
<html xml:lang= "en" lang= "en" >
<head>
    <title>Quorum</title>
    <meta charset= "UTF-8" >
    <meta content= "width=device-width, initial-scale=1" name= "viewport" >
    <script src= "https://quorumlanguage.com/embed/embed-quorum.js"  type="text/javascript"></script>
    <link rel= "stylesheet" type= "text/css" href= "https://quorumlanguage.com/embed/embed-quorum.css" >
    <style>
        html, body, main {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .quorum-embed, .ideTotal {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 0;
            border-radius: 0;
        }
        .ideTotal {
            overflow: hidden;
            background-color: #262626;
        }
        section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        #frontPageIdeInput {
            background-color: white;
        }
        #frontPageIde > section > div:nth-child(1) {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        #frontPageBuildButton {
            display: none;   
        }
        #frontPageRunButton {
            background-color: darkgreen; /* navy; */  
            padding-top: 7px; 
            font-size: 0.9em;
            line-height: 1.6em;
        }
        #frontPageStopButton {
            background-color: darkred;   
            font-size: 1.3em;
            line-height: 1.6em;
        }
        .ideVisualOutput {
            display: none;   
        }
        .allInOneIdeTitle, .allInOneIdeSubtitle {
            display: none;
        }
        .ideTextboxInput {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        textarea.ideEditing {
            flex: 1;
        }
        .FlexBuildButton {
            padding: 2px;
            font-size: 0.8em;
        }
        #frontPageIdeOutput {
            background-color: #262626;
            color: white;
            border: 0;
            margin-left: 0.5em;
            height: 13.8em;
            position: relative;
            top: 0.5em; 
        }
    </style>
</head>
<body>
    <main id="main" tabindex="-1" role="main">
        <script> 
            // Get where you want to make a quorum environment and add it.
            var body = document.getElementById("main");
            InjectQuorumEnvironment(body, "frontPage", `output "Hello, World!" 
`);
            // Replace button text with visual icons
            document.getElementById('frontPageRunButton').textContent = '\u25B6'; // &#9654;
            document.getElementById('frontPageStopButton').textContent = '\u23F9'; // &#9633;
            // Reset output html field
            document.getElementById('frontPageRunButton').onclick = function() {
                document.getElementById('frontPageIdeOutput').innerHTML = 'Running...';
                newRunCode('frontPageIdeInput', 'frontPageIdeOutput', 'frontPageQuorumUIContainer', true);
            }
            // Add key event management in the code editor
            document.addEventListener('DOMContentLoaded', function() {
                var codeInput = document.getElementById('frontPageideTextboxInput');
                var preElement = document.querySelector('#frontPageIdeInput .syntaxHighlighting code');
              
                codeInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {

                        e.preventDefault(); // Cancel default behavior 
                        // Insert 4 spaces at the cursor position
                        var start = this.selectionStart;
                        var end = this.selectionEnd;
                        var value = this.value; // Raw code without syntax coloring 
                        var lines = value.split('\n');
                        var startLine = value.substr(0, start).split('\n').length - 1;
                        var endLine = value.substr(0, end).split('\n').length - 1;
                                
                        // Fonction to add or remove 4 spaces for indentation
                        var adjustIndentation = function(line, add) {
                            if (add) {
                                return '    ' + line;
                            } else {
                                return line.replace(/^( {1,4})/, '');
                            }
                        };
                        
                        if (start === end) {
                            // No selection, just insering 4 spaces at cursor position
                            if (!e.shiftKey) {
                                document.execCommand('insertText', false, '    ');
                            } else {
                                // For Shift+Tab, we remove 4 spaces on each line
                                var currentLine = lines[startLine];
                                var newLine = adjustIndentation(currentLine, false);
                                var startOfLine = value.lastIndexOf('\n', start - 1) + 1;
                                var endOfLine = value.indexOf('\n', start);
                                if (endOfLine === -1) endOfLine = value.length;
                                var cursorOffset = start - startOfLine;
                                var removedSpaces = currentLine.length - newLine.length;
                                this.setSelectionRange(startOfLine, endOfLine);
                                document.execCommand('insertText', false, newLine);
                                var newCursorPosition = Math.max(startOfLine, start - removedSpaces); // Ajust cursor position
                                this.setSelectionRange(newCursorPosition, newCursorPosition);
                            }
                        } else {
                            // Multi-lines selection
                            var newLines = lines.slice(startLine, endLine + 1).map(line => adjustIndentation(line, !e.shiftKey));
                            var newText = newLines.join('\n');
                            var selectionStart = value.lastIndexOf('\n', start - 1) + 1;
                            var selectionEnd = endLine === lines.length - 1 ? value.length : value.indexOf('\n', end);
                            this.setSelectionRange(selectionStart, selectionEnd);
                            document.execCommand('insertText', false, newText);
                            // Selection ajustment
                            var newStart = value.substr(0, selectionStart).length + (startLine > 0 ? 1 : 0);
                            var newEnd = newStart + newText.length;
                            this.setSelectionRange(newStart, newEnd);
                        }

                        preElement.innerText = this.value;
                        editAreaUpdate(this); // Call syntax coloring function
                    } 
                });
            });
        </script>
    </main>
</body>
</html>
